<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>绑定用户</title>
</head>
<body>
    <form>
        <label>手机号码</label><input id="phone" name="phone" value=""/><br/>
        <label>验证码</label><input id="identifyCode" name="identifyCode" value=""/>
        <input type="button" value="获取验证码"><br/>
        <input type="button" value="确定" onclick="validateForm"/><input value="取消"/>
    </form>
    <script>
        String.prototype.trim=function(){
            return this.replace(/(^\s*)|(\s*$)/g, "");
        }
        function validatePhone(){
            var phoneStr = document.querySelector('#phone').value.trim();
            var isPhone = !!phoneStr.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/);
            return isPhone;
        }
        function validateForm(){
            var phoneStr = document.querySelector('#phone').value.trim();
            var identifyCodeStr = document.querySelector('#identifyCode').value.trim();
            if(phoneStr === ''){
                alert('请输入手机号');
                return;
            }
            if(!validatePhone()){
                alert('手机号码格式错误');
            }
            if(identifyCodeStr === ''){
                alert('请输入验证码');
                return;
            }
            RemoteValidateIC(phoneStr, identifyCodeStr, function(err, data){
                if(err){
                    alert('验证失败');
                }
                alert('验证成功');
            });
        }
        function RemoteValidateIC(phoneStr, identifyCodeStr, callback){
            var oAjax = new XMLHttpRequest();
            oAjax.open('POST', '/validateIc', true);
            oAjax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            oAjax.send('phone='+phoneStr+'&ic='+identifyCodeStr);
            oAjax.onreadystatechange = function(){
                if(oAjax.readyState == 4){
                    if(oAjax.status == 200){
                        callback(null, oAjax.responseText)
                    }else{
                        callback(new Error('验证错误'), null);
                    }
                }
            };
        }
    </script>
</body>
</html>